<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tax System - ApartmentCore Wiki</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    * {
        box-sizing: border-box;
    }

    body {
        font-family: 'Outfit', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #0a0c10 0%, #111316 50%, #1a1d23 100%);
        color: #e4e6ea;
        min-height: 100vh;
    }

    /* Header Utama */
    .page-header {
        text-align: center;
        margin-bottom: 50px;
        padding: 40px 0;
    }

    .page-header h1 {
        color: #ffffff;
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 16px;
        background: linear-gradient(135deg, #ffd966 0%, #f4d03f 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 4px 20px rgba(255, 217, 102, 0.3);
    }

    .page-header p {
        color: #9ca3af;
        font-size: 1.2rem;
    }

    /* Navigation Breadcrumb */
    .breadcrumb {
        max-width: 1400px;
        margin: 0 auto 40px;
        padding: 16px 24px;
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 217, 102, 0.1);
        border-radius: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 14px;
    }

    .breadcrumb a {
        color: #ffd966;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .breadcrumb a:hover {
        color: #f4d03f;
        text-shadow: 0 0 10px rgba(255, 217, 102, 0.5);
    }

    .breadcrumb span {
        color: #6b7280;
    }

    /* Content Container */
    .content-container {
        max-width: 1400px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 32px;
        align-items: start;
    }

    /* Side Navigation */
    .side-nav {
        position: sticky;
        top: 20px;
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 217, 102, 0.1);
        border-radius: 20px;
        padding: 24px;
        box-shadow: 0 12px 25px rgba(0,0,0,0.35);
    }

    .nav-title {
        color: #ffd966;
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 16px;
        letter-spacing: 0.5px;
    }

    .nav-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .nav-list li {
        margin-bottom: 8px;
    }

    .nav-list a {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        border-radius: 12px;
        color: #e4e6ea;
        text-decoration: none;
        transition: all 0.3s ease;
        font-size: 14px;
    }

    .nav-list a:hover {
        background: linear-gradient(135deg, rgba(255, 217, 102, 0.1) 0%, rgba(244, 208, 63, 0.1) 100%);
        color: #ffd966;
        transform: translateX(4px);
    }

    .nav-list a.active {
        background: linear-gradient(135deg, rgba(255, 217, 102, 0.15) 0%, rgba(244, 208, 63, 0.15) 100%);
        color: #ffd966;
        border-left: 3px solid #ffd966;
    }

    .nav-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #ffd966;
        opacity: 0.6;
    }

    /* Main Content */
    .main-content {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 217, 102, 0.1);
        border-radius: 24px;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }

    /* Section Styles */
    .content-section {
        padding: 32px;
        border-bottom: 1px solid rgba(255, 217, 102, 0.05);
        scroll-margin-top: 20px;
    }

    .content-section:last-child {
        border-bottom: none;
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 24px;
    }

    .section-title h2 {
        color: #ffd966;
        font-size: 1.8rem;
        font-weight: 600;
        margin: 0;
    }

    .section-badge {
        display: inline-flex;
        align-items: center;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: linear-gradient(135deg, rgba(255, 217, 102, 0.2) 0%, rgba(244, 208, 63, 0.2) 100%);
        color: #ffd966;
        border: 1px solid rgba(255, 217, 102, 0.3);
    }

    /* Text Styles */
    h3 {
        color: #ffd966;
        font-size: 1.3rem;
        font-weight: 600;
        margin-top: 28px;
        margin-bottom: 16px;
    }

    p {
        color: #d1d5db;
        line-height: 1.8;
        margin-bottom: 16px;
    }

    /* Lists */
    ul, ol {
        color: #d1d5db;
        margin-bottom: 20px;
        padding-left: 24px;
    }

    li {
        margin-bottom: 12px;
        line-height: 1.7;
    }

    li strong {
        color: #ffd966;
        font-weight: 600;
    }

    /* Code Blocks */
    pre {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 217, 102, 0.2);
        border-radius: 12px;
        padding: 20px;
        overflow-x: auto;
        margin: 20px 0;
        position: relative;
    }

    code {
        font-family: 'Outfit', monospace;
        font-size: 14px;
        color: #ffd966;
    }

    p code, li code {
        background: rgba(255, 217, 102, 0.1);
        padding: 4px 8px;
        border-radius: 6px;
        color: #ffd966;
        font-weight: 500;
        border: 1px solid rgba(255, 217, 102, 0.2);
    }

    /* Copy Button for Code Blocks */
    .code-block-wrapper {
        position: relative;
        margin: 20px 0;
    }

    .copy-button {
        position: absolute;
        top: 12px;
        right: 12px;
        background: linear-gradient(135deg, #ffd966 0%, #f4d03f 100%);
        color: #111316;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 10;
    }

    .copy-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 217, 102, 0.3);
    }

    .copy-button.copied {
        background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        color: #ffffff;
    }

    /* Alert/Info Boxes */
    .info-box {
        background: linear-gradient(135deg, rgba(255, 217, 102, 0.1) 0%, rgba(244, 208, 63, 0.1) 100%);
        border: 2px solid rgba(255, 217, 102, 0.3);
        border-radius: 16px;
        padding: 20px;
        margin: 24px 0;
    }

    .info-box-title {
        color: #ffd966;
        font-weight: 600;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .info-box-content {
        color: #e4e6ea;
        line-height: 1.7;
    }
    
    .warning-box {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
        border: 2px solid rgba(239, 68, 68, 0.3);
        border-radius: 16px;
        padding: 20px;
        margin: 24px 0;
    }

    .warning-box-title {
        color: #ef4444;
        font-weight: 600;
        margin-bottom: 8px;
    }

    /* Progress Steps */
    .steps-container {
        margin: 32px 0;
    }

    .step {
        display: flex;
        gap: 20px;
        margin-bottom: 24px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.01);
        border-radius: 16px;
        border: 1px solid rgba(255, 217, 102, 0.1);
        transition: all 0.3s ease;
    }

    .step:hover {
        background: rgba(255, 217, 102, 0.05);
        transform: translateX(4px);
        border-color: rgba(255, 217, 102, 0.3);
    }

    .step-number {
        min-width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #ffd966 0%, #f4d03f 100%);
        color: #111316;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 18px;
    }

    .step-content {
        flex: 1;
    }

    .step-title {
        color: #ffd966;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .step-description {
        color: #d1d5db;
        line-height: 1.7;
    }

    /* Custom Table (for Tax Status) */
    .data-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: transparent;
    }

    .data-table thead th {
        background: linear-gradient(135deg, #1a1d23 0%, #111316 100%);
        color: #ffd966;
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: 2px solid rgba(255, 217, 102, 0.2);
    }

    .data-table tbody tr {
        transition: all 0.3s ease;
        border-bottom: 1px solid rgba(255, 217, 102, 0.05);
    }

    .data-table tbody tr:hover {
        background: rgba(255, 217, 102, 0.05);
    }

    .data-table tbody td {
        padding: 16px 20px;
        color: #e4e6ea;
        font-size: 14px;
    }

    .data-table tbody td:first-child {
        font-weight: 600;
        color: #ffd966;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .content-container {
            grid-template-columns: 1fr;
        }

        .side-nav {
            position: static;
            margin-bottom: 32px;
        }

        .nav-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
        }
    }

    @media (max-width: 768px) {
        .page-header h1 {
            font-size: 2.2rem;
        }

        .content-section {
            padding: 24px;
        }

        .section-title h2 {
            font-size: 1.5rem;
        }

        .data-table {
            font-size: 13px;
        }

        .data-table thead th,
        .data-table tbody td {
            padding: 12px 16px;
        }
    }

    @media (max-width: 480px) {
        body {
            padding: 15px;
        }

        .page-header h1 {
            font-size: 1.8rem;
        }

        .content-section {
            padding: 20px;
        }

        .step {
            flex-direction: column;
            gap: 12px;
        }

        .step-number {
            align-self: flex-start;
        }
    }

    /* Scrollbar Customization */
    ::-webkit-scrollbar {
        width: 12px;
        height: 12px;
    }

    ::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 6px;
    }

    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #ffd966 0%, #f4d03f 100%);
        border-radius: 6px;
        border: 2px solid transparent;
        background-clip: content-box;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #f4d03f 0%, #ffd966 100%);
    }
</style>
</head>
<body>
<div class="page-header">
<h1>Tax System</h1>
<p>Understanding apartment taxes, payments, and penalties</p>
</div>

<div class="breadcrumb">
    <a href="[https://sites.google.com/view/apartment-core/homepage](https://sites.google.com/view/apartment-core/homepage)">Wiki Home</a>
    <span>‚Ä∫</span>
    <span style="color: #e4e6ea;">Tax System</span>
</div>

<div class="content-container">
    <nav class="side-nav">
        <div class="nav-title">On This Page</div>
        <ul class="nav-list">
            <li><a href="#overview" class="active"><span class="nav-dot"></span>Overview</a></li>
            <li><a href="#how-it-works"><span class="nav-dot"></span>How It Works</a></li>
            <li><a href="#tax-statuses"><span class="nav-dot"></span>Tax Statuses</a></li>
            <li><a href="#tax-calculation"><span class="nav-dot"></span>Tax Calculation</a></li>
            <li><a href="#commands"><span class="nav-dot"></span>Player Commands</a></li>
            <li><a href="#auto-payment"><span class="nav-dot"></span>Auto-Payment</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <section class="content-section" id="overview">
            <div class="section-title">
                <h2>Overview</h2>
                <span class="section-badge">Key Concepts</span>
            </div>
            
            <p>ApartmentCore uses a modern, invoice-based tax system to create a dynamic economy. Instead of a simple flat tax, apartment owners receive regular invoices that must be paid to keep their property in good standing. This system includes progressive penalties for late payments, automated notifications, and an optional auto-payment feature.</p>
            <p>The goal is to provide a realistic and engaging economic experience where managing your finances is key to maintaining ownership of your valuable properties.</p>
        </section>

        <section class="content-section" id="how-it-works">
            <div class="section-title">
                <h2>How It Works</h2>
                <span class="section-badge">System Flow</span>
            </div>
            <p>The entire tax system is automated and follows a clear, real-time cycle. Here is the step-by-step flow from invoice generation to potential repossession.</p>

            <div class="steps-container">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Invoice Generation</div>
                        <div class="step-description">
                            Every <strong>24 real-world hours</strong>, the system generates a new tax invoice for each apartment you own. You will receive an in-game notification when a new invoice is created.
                        </div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">Due Date</div>
                        <div class="step-description">
                            Each new invoice is due <strong>3 days</strong> after it is created. You will receive a reminder notification one day before the due date.
                        </div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">Status Change</div>
                        <div class="step-description">
                            If an invoice is not paid by its due date, your apartment's tax status will change, leading to penalties. The system determines your status based on your <strong>oldest unpaid invoice</strong>.
                        </div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <div class="step-title">Repossession</div>
                        <div class="step-description">
                            If taxes remain unpaid for <strong>7 or more days</strong>, the apartment is permanently repossessed. Ownership is removed, and all apartment data is reset.
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="content-section" id="tax-statuses">
            <div class="section-title">
                <h2>Tax Statuses</h2>
                <span class="section-badge">Penalties</span>
            </div>
            <p>Your apartment's tax status determines its functionality and the penalties applied. The status is based on the age of your oldest unpaid invoice.</p>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Condition</th>
                        <th>Effect</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>‚úÖ ACTIVE</td>
                        <td>0-2 days overdue</td>
                        <td>Normal operation. Your apartment can generate income.</td>
                    </tr>
                    <tr>
                        <td>‚ö†Ô∏è OVERDUE</td>
                        <td>3-4 days overdue</td>
                        <td><strong>Income generation is disabled.</strong> You can still use the apartment.</td>
                    </tr>
                    <tr>
                        <td>‚ùå INACTIVE</td>
                        <td>5-6 days overdue</td>
                        <td><strong>Apartment becomes unusable.</strong> You cannot enter or manage it.</td>
                    </tr>
                    <tr>
                        <td>üíÄ REPOSSESSION</td>
                        <td>7+ days overdue</td>
                        <td><strong>Ownership is permanently removed.</strong> The apartment is reset.</td>
                    </tr>
                </tbody>
            </table>
             <div class="warning-box">
                <div class="warning-box-title">‚ö†Ô∏è Repossession is Final</div>
                <div class="info-box-content">
                    Once an apartment is repossessed, you lose ownership and all associated data (ratings, stats, guestbook). The property returns to the market. There is no way to reverse this process.
                </div>
            </div>
        </section>

        <section class="content-section" id="tax-calculation">
            <div class="section-title">
                <h2>Tax Calculation</h2>
                <span class="section-badge">The Math</span>
            </div>
            
            <p>The amount of tax you owe is based on the apartment's level and its current tax status.</p>

            <h3>Base Tax Amount</h3>
            <p>The base tax is calculated as a percentage of the apartment's original purchase price. The percentage increases with the apartment's level.</p>
            <div class="code-block-wrapper">
                <pre><code>Base Tax = Price √ó (Level √ó 2.5%)</code></pre>
            </div>
            <p>For example, a Level 3 apartment has a base tax rate of <code>3 * 2.5% = 7.5%</code> of its price.</p>

            <h3>Penalty Multipliers</h3>
            <p>If your taxes are overdue, a penalty multiplier is applied to any <strong>new</strong> invoices being generated. This encourages timely payments.</p>
            <ul>
                <li><strong>ACTIVE Status:</strong> 1x Multiplier (Normal tax amount)</li>
                <li><strong>OVERDUE Status:</strong> 2x Multiplier (New invoices are double the base tax)</li>
                <li><strong>INACTIVE Status:</strong> 3x Multiplier (New invoices are triple the base tax)</li>
            </ul>

             <div class="info-box">
                <div class="info-box-title">
                    üí° Example
                </div>
                <div class="info-box-content">
                   If your apartment is in <strong>OVERDUE</strong> status, the next daily tax invoice generated will be for <strong>twice</strong> the normal amount. This multiplier does not affect existing unpaid invoices.
                </div>
            </div>
        </section>

        <section class="content-section" id="commands">
            <div class="section-title">
                <h2>Player Commands</h2>
                <span class="section-badge">Interface</span>
            </div>
            <p>You can manage your apartment taxes using the following commands.</p>

            <h3>Check Tax Information</h3>
            <p>View the current tax status, total amount due, and a list of all unpaid invoices for your apartments.</p>
            <div class="code-block-wrapper">
                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                <pre><code>/apartmentcore tax info</code></pre>
            </div>

            <h3>Pay Taxes</h3>
            <p>Pays all outstanding invoices across all of your apartments. The command will fail if you do not have enough money to cover the total amount due.</p>
            <div class="code-block-wrapper">
                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                <pre><code>/apartmentcore tax pay</code></pre>
            </div>
        </section>
        
        <section class="content-section" id="auto-payment">
            <div class="section-title">
                <h2>Auto-Payment</h2>
                <span class="section-badge">Convenience</span>
            </div>
            <p>To avoid missing payments, you can enable the auto-payment feature. When enabled, the system will automatically withdraw funds from your account to pay tax invoices as soon as they are created.</p>
            
            <h3>Enable or Disable Auto-Payment</h3>
            <p>This setting applies to all apartments you own.</p>
            <div class="code-block-wrapper">
                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                <pre><code>/apartmentcore tax auto &lt;on|off&gt;</code></pre>
            </div>
            
            <div class="info-box">
                <div class="info-box-title">
                    üí° How it Works
                </div>
                <div class="info-box-content">
                    If auto-payment is on, the system will attempt to pay the newest invoice first. If you have enough money, the payment is made instantly. If you have older unpaid invoices, it will then try to pay those, from oldest to newest. The process stops if you run out of funds.
                </div>
            </div>
        </section>
    </main>
</div>

<script>
// Hardened interactivity for Google Sites embedding
(function() {
    // Robust clipboard copy with fallback for sandboxed iframes
    function legacyCopy(text) {
        try {
            // Preserve UI state to prevent any scroll jumps
            var prevFocus = document.activeElement;
            var x = window.pageXOffset || window.scrollX || 0;
            var y = window.pageYOffset || window.scrollY || 0;

            var ta = document.createElement('textarea');
            ta.value = text || '';
            ta.setAttribute('readonly', '');
            ta.setAttribute('aria-hidden', 'true');
            // Style to avoid any layout/scroll impact
            ta.style.position = 'fixed';
            ta.style.top = '0';
            ta.style.left = '0';
            ta.style.width = '1px';
            ta.style.height = '1px';
            ta.style.opacity = '0';
            ta.style.pointerEvents = 'none';
            ta.style.zIndex = '-1';
            ta.style.contain = 'strict';

            document.body.appendChild(ta);
            try { ta.focus({ preventScroll: true }); } catch (e) { try { ta.focus(); } catch (_) {} }
            ta.select();

            var ok = false;
            try { ok = document.execCommand('copy'); } catch (e) { ok = false; }

            document.body.removeChild(ta);

            // Restore focus and scroll position
            try {
                if (prevFocus && typeof prevFocus.focus === 'function') {
                    try { prevFocus.focus({ preventScroll: true }); } catch (e) { prevFocus.focus(); }
                }
            } catch (_) {}
            try { window.scrollTo(x, y); } catch (_) {}

            return ok ? Promise.resolve() : Promise.reject(new Error('execCommand failed'));
        } catch (err) {
            return Promise.reject(err);
        }
    }

    function safeCopyText(text) {
        if (!text) return Promise.reject(new Error('No text to copy'));
        if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
            return navigator.clipboard.writeText(text).catch(function() {
                return legacyCopy(text);
            });
        }
        return legacyCopy(text);
    }

    // Keep global for inline onclick while also supporting delegated clicks
    window.copyCode = function(button) {
        var wrapper = (button && button.closest) ? button.closest('.code-block-wrapper') : (button ? button.parentElement : null);
        var codeEl = wrapper ? wrapper.querySelector('pre code') : null;
        var text = codeEl ? codeEl.textContent : '';
        var targetBtn = button || (wrapper ? wrapper.querySelector('.copy-button') : null);

        safeCopyText(text).then(function() {
            if (targetBtn) {
                targetBtn.textContent = 'Copied!';
                targetBtn.classList.add('copied');
                setTimeout(function() {
                    targetBtn.textContent = 'Copy';
                    targetBtn.classList.remove('copied');
                }, 2000);
            }
        });
    };

    // Ensure copy buttons are not treated as submit buttons in host context
    try {
        document.querySelectorAll('.copy-button').forEach(function(b){ b.setAttribute('type','button'); });
    } catch (_) {}

    // Event delegation for copy buttons (works even if Google Sites rewrites DOM)
    document.addEventListener('click', function(e) {
        var btn = e.target && e.target.closest ? e.target.closest('.copy-button') : null;
        if (btn) {
            // Ensure it's not a submit button and block any host handlers
            if (!btn.getAttribute('type')) btn.setAttribute('type','button');
            e.preventDefault();
            e.stopPropagation();
            if (typeof e.stopImmediatePropagation === 'function') e.stopImmediatePropagation();
            window.copyCode(btn);
        }
    }, true); // capture to intercept before host handlers

    // Prepare and harden side navigation behavior
    var navContainer = document.querySelector('.nav-list');

    if (navContainer) {
        // Remove any target attributes that may cause new tab behavior
        navContainer.querySelectorAll('a').forEach(function(a) {
            a.removeAttribute('target');
            a.setAttribute('rel', 'noopener');
            a.setAttribute('role', 'button');
        });

        // Delegated smooth scrolling to prevent default navigation/new tab
        navContainer.addEventListener('click', function(e) {
            var link = e.target && e.target.closest ? e.target.closest('a') : null;
            if (!link) return;

            var href = link.getAttribute('href') || '';
            if (href.charAt(0) === '#') {
                e.preventDefault();
                e.stopPropagation();

                var id = href.slice(1);
                var target = document.getElementById(id);
                if (target) {
                    try {
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    } catch (err) {
                        // Fallback smooth scroll
                        var start = window.pageYOffset || document.documentElement.scrollTop || 0;
                        var end = target.getBoundingClientRect().top + start - 10;
                        var duration = 400, startTime = null;
                        function step(ts) {
                            if (!startTime) startTime = ts;
                            var p = Math.min((ts - startTime) / duration, 1);
                            var ease = p < 0.5 ? 2 * p * p : -1 + (4 - 2 * p) * p;
                            window.scrollTo(0, start + (end - start) * ease);
                            if (p < 1) requestAnimationFrame(step);
                        }
                        requestAnimationFrame(step);
                    }

                    // Update active state
                    navContainer.querySelectorAll('a').forEach(function(a) { a.classList.remove('active'); });
                    link.classList.add('active');
                }
            }
        }, true); // capture to cancel host default
    }

    // Active section highlight on scroll
    var sections = Array.prototype.slice.call(document.querySelectorAll('.content-section'));
    var navLinks = Array.prototype.slice.call(document.querySelectorAll('.nav-list a'));

    function highlightNav() {
        var current = '';
        var scrollPos = (window.scrollY || window.pageYOffset || 0) + 120; // Adjusted offset
        for (var i = 0; i < sections.length; i++) {
            var s = sections[i];
            if (scrollPos >= s.offsetTop) {
                current = s.id;
            }
        }
        var hasActive = false;
        navLinks.forEach(function(link) {
            var href = link.getAttribute('href') || '';
            var isActive = href.charAt(0) === '#' && href.slice(1) === current;
            if (isActive) {
                link.classList.add('active');
                hasActive = true;
            } else {
                link.classList.remove('active');
            }
        });
        // If no section is active (e.g., at the very top), activate the first link
        if (!hasActive && navLinks.length > 0) {
            navLinks[0].classList.add('active');
             navLinks.slice(1).forEach(function(link) { link.classList.remove('active'); });
        }
    }
    window.addEventListener('scroll', highlightNav, { passive: true });
    // Initial call to set state on page load
    setTimeout(highlightNav, 100);
})();
</script>
</body>
</html>